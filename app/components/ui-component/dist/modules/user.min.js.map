{"version":3,"sources":["user/user.js"],"names":["angular","module","directive","$q","$timeout","$http","$position","$templateCache","$compile","$document","RecursionHelper","HoverDelayService","getApiUrl","personnelId","nt","url","uri","getUserData","defer","method","success","data","response","docs","length","user","fullName","last_name","preferred_name","resolve","promise","initUser","scope","sourceUrl","show","loaded","then","eBayManagerID","apiUrl","ret","manager","link","post","element","attrs","div","icon","find","appendToBody","initDiv","popupTpl","get","append","bind","css","adjustPopover","forceShow","ttPosition","placement","addClass","positionElements","top","left","hoverDelay","newInstance","register","clear","$on","close","unbind","restrict","templateUrl","compile"],"mappings":"AAOA,YACAA,SAAQC,OAAO,qBAAsB,sBAAsBC,UAAU,UACnE,KACA,WACA,QACA,YACA,iBACA,WACA,YACA,kBACA,oBACA,SAAUC,EAAIC,EAAUC,EAAOC,EAAWC,EAAgBC,EAAUC,EAAWC,EAAiBC,GAC9F,QAASC,GAAUC,EAAaC,GAC9B,GAAIC,GAAKC,CAOT,OANIH,GACFG,EAAM,sCAAwCH,EACrCC,IACTE,EAAM,yBAA2BF,GAEnCC,EAAM,iCAAmCC,EAG3C,QAASC,GAAYF,GACnB,GAAIG,GAAQf,EAAGe,OAaf,OAZAb,IACEc,OAAQ,MACRJ,IAAKA,IACJK,QAAQ,SAAUC,GACnB,GAAIA,GAAQA,EAAKC,UAAYD,EAAKC,SAASC,MAAQF,EAAKC,SAASC,KAAKC,OAAQ,CAC5E,GAAIC,GAAOJ,EAAKC,SAASC,KAAK,EAC9BE,GAAKC,SAAWD,EAAKE,UAAY,KAAOF,EAAKG,eAC7CV,EAAMW,QAAQJ,OAEdP,GAAMW,YAGHX,EAAMY,QAEf,QAASC,GAASC,GAChB,GAAIjB,GACAG,EAAQf,EAAGe,OAyBf,OAvBEH,GADEiB,EAAMC,UACFD,EAAMC,UAAYD,EAAMlB,GAExBF,EAAU,KAAMoB,EAAMlB,IAE9BkB,EAAME,MAAO,EACbF,EAAMG,QAAS,EACflB,EAAYF,GAAKqB,KAAK,SAAUf,GAC9B,GAAIA,GAAQA,EAAKgB,cAAe,CAC9B,GAAIC,GAAS1B,EAAUS,EAAKgB,cAC5BpB,GAAYqB,GAAQF,KAAK,SAAUG,GACjCP,EAAMP,KAAOJ,EACbW,EAAMG,QAAS,EACfH,EAAMP,KAAKe,QAAUD,EACrBrB,EAAMW,gBAGJR,KACFW,EAAMP,KAAOJ,GAEfW,EAAMG,QAAS,EACfjB,EAAMW,YAGHX,EAAMY,QAEf,GAAIW,IACAC,KAAM,SAAUV,EAAOW,EAASC,GAC9B,GAAIC,GACAC,EAAOH,EAAQI,KAAK,KACpBC,EAAqC,QAAtBJ,EAAMI,aACrBC,EAAU,WACZ,IAAKJ,EAAK,CACR,GAAIK,GAAW3C,EAAe4C,IAAI,2BAClCN,GAAMrC,EAAS0C,GAAUlB,GACrBgB,EACFvC,EAAUsC,KAAK,QAAQK,OAAOP,GAE9BF,EAAQS,OAAOP,GAEbG,IACFH,EAAIQ,KAAK,aAAc,WACrBR,EAAIS,IAAI,UAAW,WAErBT,EAAIQ,KAAK,aAAc,WACrBR,EAAIS,IAAI,UAAW,aAKvBC,EAAgB,SAAUC,GAC5B,GAAIC,GACAC,EAAYd,EAAMc,WAAa,KAC/BF,IACFX,EAAIS,IAAI,UAAW,SAErBT,EAAIc,SAASD,GACbD,EAAanD,EAAUsD,iBAAiBd,EAAMD,EAAKa,EAAWV,GAC9DS,EAAWI,KAAO,KAClBJ,EAAWK,MAAQ,KACnBjB,EAAIS,IAAIG,IAENM,EAAapD,EAAkBqD,YAAY,IAgB/C,OAfArB,GAAQU,KAAK,aAAc,WACzBU,EAAWE,SAAS,WAClBhB,IACAM,GAAc,GACTvB,EAAMG,QACTJ,EAASC,GAAOI,KAAK,WACnBhC,EAASmD,SAKjBZ,EAAQU,KAAK,aAAc,WACzBU,EAAWG,QACXrB,EAAIS,IAAI,UAAW,UAEdtB,EAAMmC,IAAI,WAAY,WAC3BJ,EAAWK,MAAM,GACjBzB,EAAQ0B,OAAO,cACf1B,EAAQ0B,OAAO,cACXxB,IACFA,EAAIwB,OAAO,cACXxB,EAAIwB,OAAO,kBAKrB,QACEC,SAAU,KACVC,YAAa,qBACbvC,OACEC,UAAW,IACXnB,GAAI,KAEN0D,QAAS,SAAU7B,GACjB,MAAOjC,GAAgB8D,QAAQ7B,EAASF","file":"user.min.js","sourcesContent":["'use strict';\n\nangular.module('ui-component.user', ['ui-component.deps'])\n\n    .directive('uiUser', function($q, $timeout, $http, $position,\n                                  $templateCache, $compile, $document,\n                                  RecursionHelper, HoverDelayService) {\n\n        function getApiUrl(personnelId, nt){\n            var url, uri;\n\n            if (personnelId) {\n                uri = 'solr/get?core=ldap&eBayPersonnelID=' + personnelId;\n            } else if (nt) {\n                uri = 'solr/get?core=ldap&nt=' + nt;\n            }\n\n            url = 'https://doe.corp.ebay.com/api/' + uri;\n            return url;\n        }\n\n        function getUserData(url){\n            var defer = $q.defer();\n            $http({method: 'GET', url: url}).\n                success(function(data, status, headers, config) {\n                    if (data && data.response && data.response.docs && data.response.docs.length){\n                        var user = data.response.docs[0];\n                        user.fullName = user.last_name + ', ' + user.preferred_name\n                        defer.resolve(user);\n                    } else {\n                        defer.resolve();\n                    }\n                });\n            return defer.promise;\n        }\n\n        function initUser(scope){\n            var url;\n            var defer = $q.defer();\n            if (scope.sourceUrl){\n                url = scope.sourceUrl + scope.nt;\n            } else {\n                url = getApiUrl(null, scope.nt);\n            }\n            scope.show = true;\n            scope.loaded = false;\n            getUserData(url).then(function(data){\n                if (data && data.eBayManagerID){\n                    var apiUrl = getApiUrl(data.eBayManagerID);\n                    getUserData(apiUrl).then(function(ret){\n                        scope.user = data;\n                        scope.loaded = true;\n                        scope.user.manager = ret;\n                        defer.resolve();\n                    });\n                } else {\n                    if (data){\n                        scope.user = data;\n                    }\n                    scope.loaded = true;\n                    defer.resolve();\n                }\n            });\n            return defer.promise;\n        }\n\n        var link = {\n            post:function(scope, element, attrs) {\n                var div;\n                var icon = element.find('i');\n                var appendToBody = attrs.appendToBody == 'true';\n\n                var initDiv = function(){\n                    if (!div){\n                        var popupTpl = $templateCache.get('user/user.popup.tpl.html');\n                        div = $compile(popupTpl)(scope);\n                        if (appendToBody){\n                            $document.find('body').append(div);\n                        } else {\n                            element.append(div);\n                        }\n                        if (appendToBody){\n                            div.bind('mouseenter', function(){\n                                div.css('display', 'block');\n                            });\n                            div.bind('mouseleave', function(){\n                                div.css('display', 'none');\n                            });\n                        }\n                    }\n                }\n                var adjustPopover = function(forceShow){\n                    var ttPosition;\n                    var placement = attrs.placement || 'top'\n                    if (forceShow){\n                        div.css('display', 'block');\n                    }\n                    div.addClass(placement);\n                    ttPosition = $position.positionElements(icon, div, placement, appendToBody);\n                    ttPosition.top += 'px';\n                    ttPosition.left += 'px';\n                    div.css(ttPosition);\n                }\n\n\n                var hoverDelay = HoverDelayService.newInstance(300);\n\n                element.bind('mouseenter', function() {\n                    hoverDelay.register(function(){\n                        initDiv();\n                        adjustPopover(true);\n                        if (!scope.loaded){\n                            initUser(scope).then(function(){\n                                $timeout(adjustPopover);\n                            });\n                        }\n                    });\n                });\n\n                element.bind('mouseleave', function() {\n                    hoverDelay.clear();\n                    div.css('display', 'none');\n                });\n\n                return scope.$on('$destroy', function() {\n                    hoverDelay.close(0);\n                    element.unbind('mouseenter');\n                    element.unbind('mouseleave');\n                    if (div){\n                        div.unbind('mouseenter');\n                        div.unbind('mouseleave');\n                    }\n                });\n            }\n        }\n\n        return {\n            restrict: 'EA',\n            templateUrl: 'user/user.tpl.html',\n            scope: {\n                sourceUrl: '=',\n                nt: '='\n            },\n            compile: function(element){\n                return RecursionHelper.compile(element, link);\n            }\n        };\n    });\n"],"sourceRoot":"/source/"}