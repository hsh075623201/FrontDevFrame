{"version":3,"sources":["side-menu/side-menu.js"],"names":["angular","module","directive","$q","$location","$http","$window","$timeout","$rootScope","piwik_track","username","app","pagename","prod","siteId","piwikTracker","pkBaseURL","Piwik","document","location","protocol","getTracker","setCustomVariable","trackPageView","enableLinkTracking","bindScope","scope","triggerMinify","minified","sessionStorage","setItem","cacheMinifiedKey","$emit","setActive","li","active","id","cacheActiveKey","notReady","mode","iframe","querySelector","src","user","piwik","nt","page","showSubMenu","isActive","hierarchy","split","length","isExpand","expand","processUrl","url","$$html5","indexOf","pos","pathname","replace","getListData","defer","list","getItem","cacheListKey","fromJson","resolve","sourceUrl","Config","uri","api","method","success","data","promise","restrict","templateUrl","transclude","link","initActive","l","activeLi","absUrl","doInitActive","forEach","submenu","then"],"mappings":"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","file":"side-menu.min.js","sourcesContent":["'use strict';\n\nangular.module('ui-component.side-menu', ['ui-component.deps'])\n\n    .directive('uiSideMenu', function($q, $location, $http, $window, $timeout, $rootScope) {\n        var cacheMinifiedKey = 'opsins_side_menu_minified';\n        var cacheActiveKey = 'opsins_side_menu_active';\n        var cacheListKey = 'opsins_side_menu_List_Load';\n\n        function piwik_track(username, app, pagename, prod, siteId) {\n            var piwikTracker, pkBaseURL;\n            if (typeof Piwik !== \"undefined\" && Piwik !== null) {\n                pkBaseURL = (\"https:\" === document.location.protocol ? \"https\" : \"http\") + \"://opspiwik.corp.ebay.com/piwik/\";\n                piwikTracker = Piwik.getTracker(\"\" + pkBaseURL + \"/piwik.php\", siteId);      // 1 is the website ID, replace it with your site ID\n                piwikTracker.setCustomVariable(1, \"User\", username, \"visit\");  // 1 is custom variable id, no need to change it. This line is to add custom variable \"User\"\n                piwikTracker.setCustomVariable(2, \"App\", app, \"page\");\n                piwikTracker.setCustomVariable(3, \"PageName\", pagename, \"page\");\n                piwikTracker.setCustomVariable(4, \"Prod\", prod, \"page\");\n                piwikTracker.trackPageView();\n                return piwikTracker.enableLinkTracking();\n            }\n        };\n\n        function bindScope(scope){\n\n            scope.triggerMinify = function(){\n                scope.minified = !scope.minified;\n                sessionStorage.setItem(cacheMinifiedKey, scope.minified);\n                $rootScope.$emit(\"ui-component.side-menu.trigger-minified\", scope.minified);\n            };\n\n            scope.setActive = function(li){\n                if (scope.active != li.id){\n\n                    scope.active = li.id;\n                    sessionStorage.setItem(cacheActiveKey, scope.active);\n\n                    // Set display mode\n                    if (li.notReady){\n                        scope.mode = 'comingSoon';\n                    } else if (li.iframe){\n                        scope.mode = 'iframe';\n                        var iframe = document.querySelector('iframe.capacity-dash');\n                        iframe.src = li.iframe.src;\n                    } else {\n                        scope.mode = null;\n                    }\n\n                    // Set piwik\n                    if ($rootScope.user && li.piwik){\n                        piwik_track($rootScope.user.nt, li.piwik.app, li.piwik.page, li.piwik.prod, li.piwik.siteId);\n                    }\n\n                    li.showSubMenu = true;\n                } else {\n                    li.showSubMenu = !li.showSubMenu;\n                }\n            };\n\n            scope.isActive = function(li){\n                var active = null;\n\n                if (scope.active){\n                    var hierarchy = scope.active.split('_');\n                    if (hierarchy.length > 1){\n                        active = hierarchy[0] == li.id;\n                    }\n                }\n                return active || scope.active == li.id;\n            };\n\n            scope.isExpand = function(li){\n                var expand = null;\n                if (scope.active){\n                    var hierarchy = scope.active.split('_');\n                    if (hierarchy.length > 1){\n                        expand = hierarchy[0] == li.id;\n                    }\n                }\n\n                return expand || li.showSubMenu;\n            }\n\n            scope.processUrl = function(url){\n                // when uses hash in url\n                if (url && !$location.$$html5){\n                    if (url.indexOf('/') == 0){\n                        var pos = url.indexOf(location.pathname);\n                        if (pos > -1){\n                            url = url.replace(location.pathname, '#!');\n                        }\n                    }\n                }\n                return url;\n            }\n\n        }\n\n        function getListData(scope){\n            var defer = $q.defer();\n            var list = sessionStorage.getItem(cacheListKey);\n            if (!list){\n                var url;\n                if (scope.sourceUrl){\n                    url = scope.sourceUrl;\n                } else if (typeof Config != 'undefined' && Config.uri && Config.uri.api) {\n                    url = Config.uri.api + 'uicomponent/getsidemenu';\n                } else {\n                    url = 'https://doe.corp.ebay.com/api/uicomponent/getsidemenu';\n                }\n\n                $http({method: 'GET', url: url}).\n                    success(function(data, status, headers, config) {\n                        if (data && data.length){\n                            var list = data[0].list;\n                            scope.list = angular.fromJson(list);\n\n                            if(list){\n                                sessionStorage.setItem(cacheListKey, list);\n                            }\n                            defer.resolve();\n                        }\n                    });\n            } else {\n                scope.list = angular.fromJson(list);\n                defer.resolve();\n            }\n            return defer.promise;\n        }\n\n        return {\n            restrict: 'EAC',\n            templateUrl: 'side-menu/side-menu.tpl.html',\n            scope: {\n                sourceUrl: '='\n            },\n            transclude: true,\n            link: function postLink(scope, el, attr, transclusion) {\n                bindScope(scope);\n\n                scope.minified = sessionStorage.getItem(cacheMinifiedKey) == 'true';\n                var activeLi = sessionStorage.getItem(cacheActiveKey);\n\n                function initActive(l){\n                    if (activeLi) {\n                        if (l.id == activeLi){\n                            scope.setActive(l);\n                        }\n                    } else {\n                        var absUrl = $location.absUrl().replace(/\\?.*/,'');\n                        var pathname = location.pathname;\n                        if (absUrl == l.url || pathname == l.url ){\n                            scope.setActive(l)\n                        }\n                    }\n                }\n\n                function doInitActive(list){\n                    angular.forEach(list, function(l){\n                        initActive(l);\n                        if (l.submenu && l.submenu.length){\n                            doInitActive(l.submenu);\n                        }\n                    });\n                }\n\n                getListData(scope).then(function(){\n                    doInitActive(scope.list);\n\n                    if (!scope.active){\n                        scope.setActive(scope.list[0]);\n                    }\n                });\n            }\n        };\n    });\n"],"sourceRoot":"/source/"}